<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit">
    <meta name="applicable-device" content="mobile">
    <meta name="apple-touch-fullscreen" content="yes"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <link type="text/css" rel="stylesheet" href="/public/stylesheets/animation.css" media="screen" />
    <link type="text/css" rel="stylesheet" href="/public/stylesheets/css.css" media="screen"/>
    <title>无标题文档</title>
    <script type="text/javascript" src="/public/javascripts/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="/public/javascripts/jquery.transit.min.js"></script>
</head>

<body>
<!--显示第一天-->
<div class="firstdays">
    <img src="/public/images/aa/1@2x.png" alt="" />
</div>
<!--显示之后的图片-->
<div class="showOther">
    <div class="other"><div><img src="/public/images/aa/2@2x.png" alt="" /></div></div>
    <div class="other"><div><img src="/public/images/aa/3@2x.png" alt="" /></div></div>
    <div class="other" data-idx="0"><div><img src="/public/images/aa/4@2x.png" alt="" /></div></div>
    <div class="other" data-idx="1"><div><img src="/public/images/aa/5@2x.png" alt="" /></div></div>
    <div class="other" data-idx="2"><div><img src="/public/images/aa/6@2x.png" alt="" /></div></div>
    <div class="other" data-idx="3"><div><img src="/public/images/aa/7@2x.png" alt="" /></div></div>
    <div class="other" data-idx="4"><div><img src="/public/images/aa/8@2x.png" alt="" /></div></div>
    <div class="other" data-idx="5"><div><img src="/public/images/aa/9@2x.png" alt="" /></div></div>
    <div class="other" data-idx="6"><div><img src="/public/images/aa/10@2x.png" alt="" /></div></div>
    <div class="other" data-idx="7"><div><img src="/public/images/aa/11@2x.png" alt="" /></div></div>
    <div class="other" data-idx="8"><div><img src="/public/images/aa/12@2x.png" alt="" /></div></div>
    <div class="other" data-idx="9"><div><img src="/public/images/aa/13@2x.png" alt="" /></div></div>
    <div class="other" data-idx="10"><div><img src="/public/images/aa/14@2x.png" alt="" /></div></div>
    <div class="other" data-idx="11"><div><img src="/public/images/aa/15@2x.png" alt="" /></div></div>
    <div class="other others16" data-idx="12">
        <div><img src="/public/images/aa/16@2x.png" alt="" /></div>
        <p>
            <span class="sp1"><img src="/public/images/aa/16.1@2x.png" alt="" /></span>
            <span class="sp2"><img src="/public/images/aa/16.2@2x.png" alt="" /></span>
            <span class="sp3"><img src="/public/images/aa/16.3@2x.png" alt="" /></span>
            <span class="sp4"><img src="/public/images/aa/16.4@2x.png" alt="" /></span>
            <span class="sp5"><img src="/public/images/aa/16.5@2x.png" alt="" /></span>
        </p>
    </div>
    <div class="other" data-idx="13"><div><img src="/public/images/aa/17@2x.png" alt="" /></div></div>
    <div class="other" data-idx="14"><div><img src="/public/images/aa/18@2x.png" alt="" /></div></div>
    <div class="other" data-idx="15"><div><img src="/public/images/aa/19@2x.png" alt="" /></div></div>
    <div class="other" data-idx="16"><div><img src="/public/images/aa/20@2x.png" alt="" /></div></div>
    <div class="other" data-idx="17"><div><img src="/public/images/aa/21@2x.png" alt="" /></div></div>
    <div class="other" data-idx="18"><div><img src="/public/images/aa/22@2x.png" alt="" /></div></div>
    <div class="other" data-idx="19"><div><img src="/public/images/aa/23@2x.png" alt="" /></div></div>
    <div class="other others24" data-idx="20">
        <div><img src="/public/images/aa/24@2x.png" alt="" /></div>
        <p>
            <span class="sp1"><img src="/public/images/aa/24.1@2x.png" alt="" /></span>
            <span class="sp2"><img src="/public/images/aa/24.2@2x.png" alt="" /></span>
            <span class="sp3"><img src="/public/images/aa/24.3@2x.png" alt="" /></span>
            <span class="sp4"><img src="/public/images/aa/24.4@2x.png" alt="" /></span>
            <span class="sp5"><img src="/public/images/aa/24.5@2x.png" alt="" /></span>
        </p>
    </div>
    <div class="other" data-idx="21"><div><img src="/public/images/aa/25@2x.png" alt="" /></div></div>
    <div class="other" data-idx="22"><div><img src="/public/images/aa/26@2x.png" alt="" /></div></div>
    <div class="other" data-idx="23"><div><img src="/public/images/aa/27@2x.png" alt="" /></div></div>
    <div class="other" data-idx="24"><div><img src="/public/images/aa/28@2x.png" alt="" /></div></div>
</div>
<div class="img-hole"></div>
<div class="fixedbot"><div><img src="/public/images/aa/29@2x.png" alt="" /></div></div>
<script type="text/javascript">
    var globalCurrentShowEleIdx = 0;
    function getTargetName(targetName) {
        var doc = document;
        if (targetName && targetName !== 'undefined' ) {
            return doc.querySelector(targetName);
        } else {
            return false;
        }
    }
    setTimeout(function () {
       $('.firstdays').fadeOut(500);
       $('.showOther').fadeIn(500);
       $('.fixedbot').fadeIn(500).addClass('a-fadeinB');
    }, 2000);
    $(function () {
        /**
         * 显示之后的图片
         */
        var $ch = $('.showOther');
        var screenHeight = screen.height;
        var globalImgs = $ch.find('.other');
        $(globalImgs[0]).fadeIn(500).addClass('a-fadeinB');

        setTimeout(function () {
            $(globalImgs[1]).fadeIn(500).addClass('a-fadeinB');
        }, 3000);

        setTimeout(function () {
            $(globalImgs[2]).fadeIn(500).addClass('a-bouncein');
        }, 4000);

        var starTime; // 开始时间
        var touch = {}; // 设置指数
        $('body').delegate('.showOther', 'touchstart', function (e) {
            touch.isMove = true;
            touch.one = true;
            touch.startY = e.originalEvent.targetTouches[0].pageY;
            starTime = Date.now();
        }).delegate('.showOther', 'touchmove', function (e) {
            if (touch.isMove) {
                touch.moveSize = e.originalEvent.targetTouches[0].pageY - touch.startY;
            }
        }).delegate('.showOther', 'touchend', function (e) {
            if (touch.isMove) {
                var t = Date.now() - starTime;
                if (touch.moveSize > 0) return;
                var s = Math.abs(touch.moveSize);
                var v = s / t;
                console.log('move v: ', v);
                if (globalCurrentShowEleIdx > 25) return;
                if ($ch[0].scrollHeight > 1000) {
                    if (Math.abs($(document).scrollTop() - $ch[0].scrollHeight) > (300 + screenHeight)) return;
                }
                function getScrollHeightDivNum(callback) {
                    var ele = $('[data-idx=' + (++globalCurrentShowEleIdx) + ']');
                    $ch.height($ch.height() + ele.height() + 12);
                    $('body,html').animate({ scrollTop: $ch.height() }, 300, function () {
                        ele.css('display', 'block');
                        ele.addClass('a-fadeinB');
//                        touch.isMove = false;
                        callback();
                    });
                    if (globalCurrentShowEleIdx === 11) {
                        anmimateMoreImg('others16', 'a-fadeinR');
                    }
                    if (globalCurrentShowEleIdx === 19) {
                        anmimateMoreImg('others24', 'a-fadeinR');
                    }
                }
                if (v < 1) {
                    var ele = $('[data-idx=' + (++globalCurrentShowEleIdx) + ']');
                    $ch.height($ch.height() + ele.height() + 12);
                    $('body,html').animate({ scrollTop: $ch.height() }, 100, function () {
                        ele.fadeIn(200).addClass('a-fadeinB');
                        
//                        ele.css('display', 'block');
//                        ele.addClass('a-fadeinB');
//                        touch.isMove = false;
                    });

                    if (globalCurrentShowEleIdx === 11) {
                        anmimateMoreImg('others16', 'a-fadeinR');
                    }
                    if (globalCurrentShowEleIdx === 19) {
                        anmimateMoreImg('others24', 'a-fadeinR');
                    }
                } else if (v >=1 && v <= 2) {
                    async.waterfall([
                        function(callback) {
                            getScrollHeightDivNum(callback);
                        },
                        function(callback) {
                            getScrollHeightDivNum(callback);
                        }
                    ], function (err, result) {
                        console.log('done');
                    });
                } else {
                    async.waterfall([
                        function(callback) {
                            getScrollHeightDivNum(callback);
                        },
                        function(callback) {
                            getScrollHeightDivNum(callback);
                        },
                        function(callback) {
                            getScrollHeightDivNum(callback);
                        }
                    ], function (err, result) {
                        console.log('done');
                    });
                }
            }

        });
    });

    // 多图片处理
    function anmimateMoreImg(classname, anmiteClass) {
        var morepic = getTargetName('.' + classname);
        var aImgs = $(morepic).children('p').find('img');
        for (var i = 0; i < aImgs.length; i++) {
            (function (n) {
                setTimeout(function () {
                    $(aImgs[n]).fadeIn(500).addClass('' + anmiteClass);
                }, n * 1000);
            })(i);
        }
    }

</script>
</body>
</html>
